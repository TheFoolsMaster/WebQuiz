<!DOCTYPE html>
<html>
<head>
    <title>Quiz AFiBV</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<header>
    <img src="VistulaLogo.png"  alt="Logo AFiBV" id="VistulaLogo"></a>
</header>


<!-- quiz and instruction to refactor -->
<div id="quiz-container">
  <h1>Quiz AFiBV</h1>
  <div id="instructions">
    <p>Tutaj znajduje się instrukcja dotycząca quizu.</p>
    <p>Opis funkcji, działania i przebieg quizu.</p>
  </div>
  
  <!-- start Quiz button -->
  <div class="start_btn"><button>Start Quiz</button></div>
  
    <div id="question-container">
        <h2>Pytanie 1:</h2>
        <p>Treść pytania</p>
        <input type="radio" name="answer" value="A"> Odpowiedź A<br>
        <input type="radio" name="answer" value="B"> Odpowiedź B<br>
        <input type="radio" name="answer" value="C"> Odpowiedź C<br>
        <input type="radio" name="answer" value="D"> Odpowiedź D<br>
        <button onclick="nextQuestion()">Dalej</button>
        <button onclick="previousQuestion()">Wstecz</button>
    </div>

    <div id="result-container" style="display: none;">
        <h2>Wynik:</h2>
        <p id="result"></p>
        <div id="answers-container"></div>
        <button onclick="showAnswers()" id="answers_btn">Pokaż prawidłowe odpowiedzi</button>
        <button onclick="retryQuiz()" id="retry_btn">Rozpocznij ponownie</button>
        <button onclick="downloadCertificate()" id="downloadCert_btn">Pobierz certyfikat</button>
    </div>
</div>

<script>
    var questions = [
        {
            question: "Treść pytania 1",
            answers: ["Odpowiedź A", "Odpowiedź B", "Odpowiedź C", "Odpowiedź D"],
            correctAnswer: 0
        },
        {
            question: "Treść pytania 2",
            answers: ["Odpowiedź A", "Odpowiedź B", "Odpowiedź C", "Odpowiedź D"],
            correctAnswer: 1
        },
        // Add rest questions
    ];

    var currentQuestion = 0;
    var score = 0;
    var selectedAnswers = Array(questions.length).fill(null);

    function displayQuestion() {
        var questionContainer = document.getElementById("question-container");
        var question = questions[currentQuestion];
        var questionText = questionContainer.getElementsByTagName("p")[0];
        var choices = questionContainer.getElementsByTagName("input");

        questionText.textContent = question.question;

        for (var i = 0; i < choices.length; i++) {
            choices[i].value = question.answers[i];
            choices[i].checked = false;
            choices[i].setAttribute("data-question", currentQuestion);
        }

        var selectedAnswer = selectedAnswers[currentQuestion];
        if (selectedAnswer !== null) {
            var selectedInput = questionContainer.querySelector('input[value="' + selectedAnswer + '"]');
            if (selectedInput !== null) {
                selectedInput.checked = true;
            }
        }
    }

    function nextQuestion() {
        var selectedAnswer = document.querySelector('input[name="answer"]:checked');

        if (selectedAnswer === null) {
            alert("Wybierz odpowiedź!");
            return;
        }

        selectedAnswers[currentQuestion] = selectedAnswer.value;

        if (currentQuestion === questions.length - 1) {
            calculateScore();
            displayResult();
        } else {
            currentQuestion++;
            displayQuestion();
        }
    }

    function previousQuestion() {
        if (currentQuestion > 0) {
            currentQuestion--;
            displayQuestion();
        } else {
            alert("To jest pierwsze pytanie!");
        }
    }

    function calculateScore() {
        score = 0;
        for (var i = 0; i < questions.length; i++) {
            if (selectedAnswers[i] === questions[i].answers[questions[i].correctAnswer]) {
                score++;
            }
        }
    }

    function displayResult() {
        var resultContainer = document.getElementById("result-container");
        var resultText = document.getElementById("result");
        var scorePercentage = (score / questions.length) * 100;
        var passThreshold = 75;

        resultText.textContent = score + " / " + questions.length + " (" + scorePercentage + "%)";

        if (scorePercentage >= passThreshold) {
            resultText.textContent += " - PASS";
        } else {
            resultText.textContent += " - FAIL";
        }

        document.getElementById("question-container").style.display = "none";
        resultContainer.style.display = "block";
    }

    function showAnswers() {
        var answersContainer = document.getElementById("answers-container");
        answersContainer.style.display = 'block';
        answersContainer.innerHTML = '';

        for (var i = 0; i < questions.length; i++) {
            var question = questions[i];
            var questionNumber = i + 1;
            var userAnswer = selectedAnswers[i] || "";
            var correctAnswer = question.answers[question.correctAnswer];

            var answerText = document.createElement("p");
            answerText.textContent = "Pytanie " + questionNumber + ":";
            answersContainer.appendChild(answerText);

            var userAnswerText = document.createElement("p");
            userAnswerText.textContent = "Odpowiedź użytkownika: " + userAnswer;
            answersContainer.appendChild(userAnswerText);

            var correctAnswerText = document.createElement("p");
            correctAnswerText.textContent = "Poprawna odpowiedź: " + correctAnswer;
            answersContainer.appendChild(correctAnswerText);

            var separator = document.createElement("hr");
            answersContainer.appendChild(separator);
        }

        var resultContainer = document.getElementById("result-container");
        resultContainer.appendChild(answersContainer);
    }

    function retryQuiz() {
        currentQuestion = 0;
        score = 0;
        selectedAnswers = Array(questions.length).fill(null);
        displayQuestion();
        showStart();
        hideContainers();
    }

    function downloadCertificate() {
        const { jsPDF } = window.jspdf;
        var doc = new jsPDF();

        doc.setFontSize(20);
        doc.text('Certyfikat Quizu AFiBV', 10, 20);
        doc.setFontSize(16);
        doc.text('Wynik: ' + score + ' / ' + questions.length, 10, 40);
        doc.setFontSize(12);

        for (var i = 0; i < questions.length; i++) {
            var question = questions[i];
            var questionNumber = i + 1;
            var userAnswer = selectedAnswers[i] || "";

            doc.text('Pytanie ' + questionNumber + ':', 10, 60 + i * 40);
            doc.text('Odpowiedź użytkownika: ' + userAnswer, 10, 75 + i * 40);
            doc.text('Poprawna odpowiedź: ' + question.answers[question.correctAnswer], 10, 90 + i * 40);
        }

        var certificateFile = doc.output();
        var link = document.createElement('a');
        link.href = 'data:application/pdf;base64,' + btoa(certificateFile);
        link.download = 'certificate.pdf';

        document.body.appendChild(link);
        link.click();

        document.body.removeChild(link);
    }

    function startQuiz() {
        var startBtn = document.querySelector('.start_btn');
        var instructions = document.getElementById('instructions');
        var questionContainer = document.getElementById('question-container');

        startBtn.style.display = 'none';
        instructions.style.display = 'none';
        questionContainer.style.display = 'block';

        displayQuestion();
    }

    function showStart() {
        var startBtn = document.querySelector('.start_btn');
        var instructions = document.getElementById('instructions');

        startBtn.style.display = 'block';
        instructions.style.display = 'block';
    }

    function hideContainers() {
        var questionContainer = document.getElementById('question-container');
        var resultContainer = document.getElementById('result-container');
        var answerContainer = document.getElementById('answers-container');

        questionContainer.style.display = 'none';
        resultContainer.style.display = 'none';
        answerContainer.style.display = 'none';
    }

    function showContainers() {
        var questionContainer = document.getElementById('question-container');
        var resultContainer = document.getElementById('result-container');

        questionContainer.style.display = 'block';
        resultContainer.style.display = 'block';
    }

    hideContainers();
    document.querySelector('.start_btn button').addEventListener('click', startQuiz);
  </script>
</body>
</html>
